#!/bin/bash
#
# To run in parallel:
# (echo npm run lint-api & echo rubocop -a & echo rspec) | parallel --halt now,fail=1 --tag
#
echo "" && \

echo "🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸" && \
echo "▶️   Linting OpenAPI Specification" && \
npm run lint-api && \
echo "" && \

echo "🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸" && \
echo "▶️   Ensuring schema.rb is up to date" && \
echo "" && \
echo "➖ Drop database" && \
bin/rails db:drop && \
echo "" && \
echo "➖ Delete db/schema.rb" && \
rm -f -v db/scshema.rb && 
echo "" && \
echo "➖ Create database" && \
bin/rails db:create && \
echo "" && \
echo "➖ Migrate database" && \
bin/rails db:migrate && \
echo "" && \
echo "➖ Annotate model" && \
annotate --force && \
echo "" && \
echo "➖ Seed data" && \
bin/rails db:seed && \
echo "" \

echo "🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸" && \
echo "▶️   Linting & Repairing Ruby Code" && \
rubocop -a && \
echo "" && \

echo "🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸" && \
echo "▶️   Running RSpec Tests" && \
rspec && \
echo "" && \

echo "🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸" && \
echo "️✅   Done" && \
echo ""
