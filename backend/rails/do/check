#!/bin/bash
#
# To run in parallel:
# (echo npm run lint-api & echo rubocop -a & echo rspec) | parallel --halt now,fail=1 --tag
#
echo "" && \

echo "🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸" && \
echo "▶️   Linting OpenAPI Specification" && \
yarn run lint-api && \
echo "" && \

echo "🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸" && \
echo "▶️   Ensuring schema.rb is up to date" && \
echo "" && \
echo "➖ Drop database" && \
bundle exec rails db:drop && \
echo "" && \
echo "➖ Delete db/schema.rb" && \
rm -f -v db/scshema.rb && 
echo "" && \
echo "➖ Create database" && \
bundle exec rails db:create && \
echo "" && \
echo "➖ Migrate database" && \
bundle exec rails db:migrate && \
echo "" && \
echo "➖ Seed data" && \
bundle exec rails db:seed && \
echo "" \

echo "🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸" && \
echo "▶️   Annotating Models and Routes" && \
bundle exec annotate --force --models --routes && \
echo "" && \

echo "🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸" && \
echo "▶️   Linting & Repairing Ruby Code" && \
bundle exec rubocop -a && \
echo "" && \

echo "🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸" && \
echo "▶️   Running RSpec Tests" && \
bundle exec rspec --format Fuubar && \
echo "" && \

echo "🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸🔸" && \
echo "️✅   Done" && \
echo ""
